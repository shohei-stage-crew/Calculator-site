<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ©Ÿææ¶ˆè²»é›»åŠ›è¨ˆç®—</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 20px; background: #f4f6f8; color: #333; }
    label, select, button, input { margin: 5px 0; display: block; font-size: 14px; }
    .tab { display: none; }
    .tab.active { display: block; }
    .tabs { margin-bottom: 15px; }
    .tabs button {
      margin-right: 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: #007acc;
      color: white;
      cursor: pointer;
    }
    .tabs button:hover { background: #005fa3; }
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }
    button:hover { background-color: #218838; }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
      background: white;
      border-radius: 6px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
      font-size: 14px;
    }
    th { background: #e9ecef; }
    .circuit {
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .instructions {
      background: #e8f0fe;
      padding: 15px;
      border-left: 5px solid #4285f4;
      margin-bottom: 20px;
      border-radius: 6px;
    }
    .download-icon {
      display: inline-block;
      cursor: pointer;
      font-size: 18px;
      margin-left: 10px;
      vertical-align: middle;
      color: #007acc;
      user-select: none;
    }
    .download-icon:hover {
      color: #005fa3;
    }
  </style>
</head>
<body>
  <h1>æ˜Œå¹³é«˜æ ¡æ”¾é€å§”å“¡ä¼šã€€æ©Ÿææ¶ˆè²»é›»åŠ›è¨ˆç®—ã‚µã‚¤ãƒˆ</h1>

  <div class="instructions">
    <h3>ä½¿ã„æ–¹ã®æ¡ˆå†…</h3>
    <ol>
      <li>ã€Œæ©Ÿæè¿½åŠ ã€ãƒšãƒ¼ã‚¸ã§ã€é †ã«ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ»ä¸­ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ»å‹ç•ªã‚’é¸ã³ã€æ©Ÿæã‚’è¿½åŠ ã—ã¾ã™ã€‚</li>
      <li>è¿½åŠ ã—ãŸæ©Ÿæã®ä¸€è¦§ã¨åˆè¨ˆæ¶ˆè²»é›»åŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
      <li>ã€Œå›è·¯æŒ¯ã‚Šåˆ†ã‘ã€ãƒšãƒ¼ã‚¸ã§ã€Œå›è·¯ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æ©Ÿæã‚’ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§é¸æŠã—ã€å›è·¯ã”ã¨ã®é›»åŠ›åˆè¨ˆã‚’ç¢ºèªã§ãã¾ã™ã€‚</li>
      <li>ã€Œãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã€ãƒœã‚¿ãƒ³ã¾ãŸã¯ğŸ¡‡ã‚¢ã‚¤ã‚³ãƒ³ã§ã€ç¾åœ¨ã®æ§‹æˆï¼ˆå›è·¯æŒ¯ã‚Šåˆ†ã‘æœªå¯¾å¿œï¼‰ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ä¿å­˜ã§ãã¾ã™ã€‚</li>
    </ol>
    <p><strong>â€»æ¶ˆè²»é›»åŠ›ã®å°‘ãªã„æ©Ÿæã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</strong></p>
  </div>

  <div class="tabs">
    <button onclick="switchTab('main')">æ©Ÿæè¿½åŠ ãƒšãƒ¼ã‚¸</button>
    <button onclick="switchTab('circuit')">å›è·¯æŒ¯ã‚Šåˆ†ã‘ãƒšãƒ¼ã‚¸</button>
  </div>

  <div id="main" class="tab active">
    <label>å¤§ã‚«ãƒ†ã‚´ãƒªãƒ¼
      <select id="category" onchange="populateSubCategory()"></select>
    </label>
    <label>ä¸­ã‚«ãƒ†ã‚´ãƒªãƒ¼
      <select id="subCategory" onchange="populateModel()"></select>
    </label>
    <label>å‹ç•ª
      <select id="model"></select>
    </label>
    <label>å€‹æ•°
      <input type="number" id="quantity" value="1" min="1" />
    </label>
    <button onclick="addEquipment()">æ©Ÿæã‚’è¿½åŠ </button>
    <button onclick="exportToFile()">ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›</button>
    <span class="download-icon" onclick="exportToFile()" title="ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜">ğŸ¡‡</span>

    <h3>è¿½åŠ ã•ã‚ŒãŸæ©Ÿæ</h3>
    <table>
      <thead>
        <tr><th>å‹ç•ª</th><th>æ¶ˆè²»é›»åŠ›(W)</th><th>å€‹æ•°</th><th>åˆè¨ˆ(W)</th></tr>
      </thead>
      <tbody id="equipmentList"></tbody>
    </table>
    <p><strong>åˆè¨ˆæ¶ˆè²»é›»åŠ›: <span id="totalPower">0</span> W</strong></p>
  </div>

  <div id="circuit" class="tab">
    <button onclick="addCircuit()">å›è·¯ã‚’è¿½åŠ </button>
    <div id="circuits"></div>
  </div>

  <script>
    const data = {
      'éŸ³éŸ¿': {
        'ãƒŸã‚­ã‚µãƒ¼': {
          'M7CL-48ï¼ˆYAMAHAï¼‰': 300,
          'SonicView24ï¼ˆTascamï¼‰': 85,
          'XR16ï¼ˆBEHRINGERï¼‰': 30
        },
        'ã‚¢ãƒ³ãƒ—': {
          'PX5ï¼ˆYAMAHAï¼‰': 575,
          'PX8ï¼ˆYAMAHAï¼‰': 700,
          'DA-250Fï¼ˆTOAï¼‰': 1200,
          'DA-150Fï¼ˆTOAï¼‰': 800
        },
        'ãƒ‘ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼': {
          'DBR15ï¼ˆYAMAHAï¼‰': 185,
          'IRX108ï¼ˆJBLï¼‰': 80,
          'Opera10ï¼ˆdb-techï¼‰': 500,
          'Typhon-AX8ï¼ˆwharfdaleï¼‰': 200,
          'M15Bï¼ˆTurboSoundï¼‰': 700,
          'F1320Dï¼ˆBEHRINGERï¼‰': 300
        }
      },
      'ç…§æ˜': {
        'PARãƒ©ã‚¤ãƒˆ': {
          'H-PARï¼ˆStageEvolutionï¼‰': 120,
          'PAR-Zï¼ˆADJï¼‰': 115
        },
        'ãƒãƒ¼ãƒ©ã‚¤ãƒˆ': {
          'MEGA-BERï¼ˆADJï¼‰': 32
        },
        'ãƒ ãƒ¼ãƒ“ãƒ³ã‚°ãƒ˜ãƒƒãƒ‰': {
          'Pocket-Proï¼ˆADJï¼‰': 53
        },
        'ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒã‚·ãƒ³': {
          'ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒã‚·ãƒ³ï¼ˆStageEvolutionï¼‰': 1300
        }
      }
    };

    const categorySelect = document.getElementById('category');
    const subCategorySelect = document.getElementById('subCategory');
    const modelSelect = document.getElementById('model');
    const quantityInput = document.getElementById('quantity');
    const equipmentList = document.getElementById('equipmentList');
    const totalPowerElem = document.getElementById('totalPower');

    let totalPower = 0;
    let equipmentArray = [];

    function switchTab(id) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function populateCategory() {
      for (const cat in data) {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      }
      populateSubCategory();
    }

    function populateSubCategory() {
      subCategorySelect.innerHTML = '';
      modelSelect.innerHTML = '';
      const subCategories = data[categorySelect.value];
      for (const sub in subCategories) {
        const option = document.createElement('option');
        option.value = sub;
        option.textContent = sub;
        subCategorySelect.appendChild(option);
      }
      populateModel();
    }

    function populateModel() {
      modelSelect.innerHTML = '';
      const models = data[categorySelect.value][subCategorySelect.value];
      for (const model in models) {
        const option = document.createElement('option');
        option.value = model;
        option.textContent = model;
        modelSelect.appendChild(option);
      }
    }

    function addEquipment() {
      const model = modelSelect.value;
      const power = data[categorySelect.value][subCategorySelect.value][model];
      const quantity = parseInt(quantityInput.value) || 1;
      const total = power * quantity;
      const equipment = { model, power, quantity };
      equipmentArray.push(equipment);

      const row = document.createElement('tr');
      row.innerHTML = `<td>${model}</td><td>${power}</td><td>${quantity}</td><td>${total}</td>`;
      row.addEventListener('click', () => {
        equipmentArray = equipmentArray.filter(e => !(e.model === equipment.model && e.power === equipment.power && e.quantity === equipment.quantity));
        row.remove();
        totalPower -= total;
        totalPowerElem.textContent = totalPower;
        updateCircuits();
      });

      equipmentList.appendChild(row);
      totalPower += total;
      totalPowerElem.textContent = totalPower;
      updateCircuits();
    }

    function addCircuit() {
      const container = document.createElement('div');
      container.className = 'circuit';
      container.innerHTML = `
        <h4>å›è·¯</h4>
        <div class="checkboxes"></div>
        <p>åˆè¨ˆ: <span>0</span> W</p>
      `;
      document.getElementById('circuits').appendChild(container);
      updateCircuitCheckboxes(container);
    }

    function updateCircuits() {
      document.querySelectorAll('.circuit').forEach(container => updateCircuitCheckboxes(container));
    }

    function updateCircuitCheckboxes(container) {
      const checkboxesDiv = container.querySelector('.checkboxes');
      const selected = Array.from(checkboxesDiv.querySelectorAll('input:checked')).map(input => input.value);
      checkboxesDiv.innerHTML = '';
      equipmentArray.forEach((e, i) => {
        const id = `circuit-${i}`;
        const div = document.createElement('div');
        div.innerHTML = `<label><input type="checkbox" id="${id}" value="${e.power * e.quantity}" ${selected.includes((e.power * e.quantity).toString()) ? 'checked' : ''} onchange="calculateCircuitPower(this)">${e.model}ï¼ˆ${e.quantity}å°ï¼‰</label>`;
        checkboxesDiv.appendChild(div);
      });
      calculateCircuitPower(container);
    }

    function calculateCircuitPower(arg) {
      let container;
      if (arg.classList.contains('circuit')) {
        container = arg;
      } else {
        container = arg.closest('.circuit');
      }
      if (!container) return;
      let sum = 0;
      container.querySelectorAll('input:checked').forEach(input => sum += parseInt(input.value));
      container.querySelector('p span').textContent = sum;
    }

    function exportToFile() {
      let content = 'è¿½åŠ ã•ã‚ŒãŸæ©Ÿæä¸€è¦§:\n';
      equipmentArray.forEach(e => {
        content += `${e.model} x${e.quantity}: ${e.power}W Ã— ${e.quantity} = ${e.power * e.quantity}W\n`;
      });
      content += `\nåˆè¨ˆæ¶ˆè²»é›»åŠ›: ${totalPower}W\n`;
      const blob = new Blob([content], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'æ©Ÿææ¶ˆè²»é›»åŠ›.txt';
      link.click();
    }

    populateCategory();
  </script>
</body>
</html>
